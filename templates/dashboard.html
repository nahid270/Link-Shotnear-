<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">üîó My Dashboard</a>
            <button class="btn btn-outline-danger" id="logout-btn">Logout</button>
        </div>
    </nav>

    <div class="container mt-4">
        <h3>Shorten a new link</h3>
        <form id="shorten-form" class="d-flex mb-4">
            <input type="url" id="original-url" class="form-control me-2" placeholder="Enter your long URL here" required>
            <button type="submit" class="btn btn-primary">Shorten</button>
        </form>
        <div id="result" class="alert alert-success d-none"></div>
        
        <hr>
        
        <h3>My Links</h3>
        <p>Your created links will appear here...</p>
        <!-- ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá -->
    </div>

    <script>
        const token = localStorage.getItem('jwt_token');

        // ‡¶Ø‡¶¶‡¶ø ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßá‡¶ú‡ßá ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶¨‡ßá
        if (!token) {
            window.location.href = '/login-page';
        }

        // ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶¨‡¶æ‡¶ü‡¶®
        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('jwt_token');
            window.location.href = '/';
        });

        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶∂‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ
        document.getElementById('shorten-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const url = document.getElementById('original-url').value;
            const resultDiv = document.getElementById('result');

            const response = await fetch('/shorten', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}` // ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                },
                body: JSON.stringify({ url })
            });

            const data = await response.json();

            if (response.ok) {
                resultDiv.textContent = `Success! Short URL: ${data.short_url}`;
                resultDiv.classList.remove('d-none');
                this.reset(); // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
            } else {
                resultDiv.textContent = `Error: ${data.error}`;
                resultDiv.classList.add('alert-danger');
                resultDiv.classList.remove('d-none', 'alert-success');
            }
        });

        // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶∞‡ßá‡¶ï‡¶ü‡¶ø fetch() ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶∏‡¶¨ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶è‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®
    </script>
</body>
</html>
